# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest


stages:
  - stage: Build
    jobs:
    - job: Build
      steps:
      - task: Docker@2
        inputs:
          containerRegistry: 'warsztaty.azurecr.io'
          repository: 'MinApi'
          command: 'buildAndPush'
          Dockerfile: 'src/MinApi/Dockerfile'
          buildContext: 'src/MinApi/'
      - task: replacetokens@5
        inputs:
          targetFiles: 'infra/*.yaml'
          encoding: 'auto'
          tokenPattern: 'default'
          writeBOM: true
          actionOnMissing: 'warn'
          keepToken: false
          actionOnNoFiles: 'continue'
          enableTransforms: false
          enableRecursion: false
          useLegacyPattern: false
          enableTelemetry: true
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: 'infra/*.yaml'
          artifact: 'manifest'
          publishLocation: 'pipeline'